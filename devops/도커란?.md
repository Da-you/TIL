도커란?
==

- 소프트웨어 환경의 일관성 문제를 해결하기 위해 등장
    - 배포 환경 차이로 인한 문제를 최소화하기 위함(버전, 운영체제 등등)
- 애플리케이션 자체와 실행에 필요한 환경을 하나의 단위 즉 '컨테이너'라는 독립적인 환경에서 실행함
    - 예를 들면 '밀키트'와 같다. 재료 선별, 손질 등 필요 없이 키트에 들어 있는 재료를 넣고 만들면 끝
- 이식성이 좋아 확장에 용이하다.

---

## 사용처

- 서비스 배포
    - 도커 이미지로 패키징으로 어느 환경에서든 실행 가능
- 테스트 및 개발
    - 컨테이너라는 격리된 환경을 제공해 테스트할 때유용
    - CI/CD 파이프라인에서 애플리케이션을 테스트할 때도 유용
- MSA
    - 예를 들어, 웹서비스, DB, 캐시 서버 등을 각각의 컨테이너로 분리해 관리 가능
- 애플리케이션 의존성 관리
    - 애플리케이션과 함께 필요한 라이브러리의 의존성을 함께 묶어 실행해 라이브러리 충돌, 버전 불일치 문제에 대한 부담을 덜 수 있다.

---

## 도커 파일

- 도커 이미지를 만들기 위해서는 도커 파일이 필요하다.

```dockerfile
FROM openjdk:17-jdk-slim
ARG JAR_FILE=build/libs/*.jar
WORKDIR /app
COPY ${JAR_FILE} app.jar
EXPOSE 8080
ENV SPRING_PROFILES_ACTIVE=prod
VOLUME /data
ENTRYPOINT ["java", "-jar", "app.jar"] 
```

- FROM : 베이스 이미지를 지정
- WORKDIR : 컨테이너 내 작업 디렉토리 설정
- COPY : 로컬 파일을 컨테이너 내부로 복사
- ENTRYPOINT : 컨테이너 실행 시 실행할 명령어
- EXPOSE : 컨테이너에서 사용할 포트 지정
- ENV : 환경 변수를 설정
- ARG : 빌드 시 인자를 전달하는 변수
- VOLUME : 컨테이너와 호스트 간 데이터 공유를 위한 볼륨 생성

---

## 명령어

| 명령어                               | 설명                              |
|-----------------------------------|---------------------------------|
| `docker pull <이미지>`               | 도커 허브에서 이미지를 다운로드               |
| `docker images`                   | 로컬에 저장된 도커 이미지 목록 조회            |
| `docker rmi <이미지>`                | 특정 도커 이미지 삭제                    |
| `docker ps`                       | 실행 중인 컨테이너 목록 조회                |
| `docker ps -a`                    | 모든 컨테이너 목록 조회 (종료된 컨테이너 포함)     |
| `docker run <이미지>`                | 컨테이너 생성 및 실행                    |
| `docker run -d <이미지>`             | 백그라운드에서 컨테이너 실행 (Detached Mode) |
| `docker run --name <컨테이너명> <이미지>` | 컨테이너에 이름을 지정하여 실행               |
| `docker run -p 8080:80 <이미지>`     | 컨테이너의 포트를 호스트에 연결하여 실행          |
| `docker start <컨테이너>`             | 중지된 컨테이너 실행                     |
| `docker stop <컨테이너>`              | 실행 중인 컨테이너 중지                   |
| `docker restart <컨테이너>`           | 컨테이너 재시작                        |
| `docker rm <컨테이너>`                | 특정 컨테이너 삭제                      |
| `docker rm $(docker ps -aq)`      | 모든 컨테이너 삭제                      |
| `docker logs <컨테이너>`              | 컨테이너의 로그 출력                     |

---

**🔹 컨테이너 내부 명령어 (실행 및 접근)**

| 명령어                                | 설명                              |
|------------------------------------|---------------------------------|
| `docker exec -it <컨테이너> /bin/bash` | 실행 중인 컨테이너 내부로 접속 (`bash` 쉘 실행) |
| `docker exec -it <컨테이너> <명령어>`     | 실행 중인 컨테이너에서 명령어 실행             |
| `docker attach <컨테이너>`             | 실행 중인 컨테이너에 터미널을 연결             |
| `docker cp <컨테이너>:<경로> <호스트경로>`    | 컨테이너에서 파일을 호스트로 복사              |
| `docker cp <호스트경로> <컨테이너>:<경로>`    | 호스트에서 컨테이너로 파일 복사               |

---

**🔹 이미지 빌드 및 태깅 (Dockerfile 관련 명령어)**

| 명령어                             | 설명                                 |
|---------------------------------|------------------------------------|
| `docker build -t <이미지명>:<태그> .` | 현재 디렉토리의 `Dockerfile`을 기반으로 이미지 빌드 |
| `docker tag <이미지> <저장소>:<태그>`   | 이미지에 태그 추가                         |
| `docker push <저장소>:<태그>`        | 도커 허브 또는 개인 레지스트리에 이미지 업로드         |
| `docker pull <저장소>:<태그>`        | 도커 허브에서 특정 이미지 다운로드                |
| `docker inspect <이미지 또는 컨테이너>`  | 이미지 또는 컨테이너의 상세 정보 조회              |